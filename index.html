<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Snowglobe Collection</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        .map-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        #map {
            width: 100%;
            height: 700px;
        }
        .collection-info {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        .info-card {
            flex: 1;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h2 {
            color: #3498db;
            margin-top: 0;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 15px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border-radius: 50%;
            border: 1px solid #333;
        }
        .loading {
            text-align: center;
            font-size: 1.5em;
            margin: 100px 0;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #7f8c8d;
        }
        @media (max-width: 768px) {
            .collection-info {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>My Snowglobe Collection</h1>
        <p class="subtitle">A journey around the world, one snowglobe at a time</p>
    </header>

    <div class="map-container">
        <div id="map">
            <div class="loading">Loading map...</div>
        </div>
    </div>

    <div class="collection-info">
        <div class="info-card">
            <h2>About My Collection</h2>
            <p>Welcome to my snowglobe collection! Each snowglobe represents a special place I've visited or received as a gift from loved ones.</p>
            <p>The map above shows the locations of all my snowglobes. The size of each bubble represents the population of the city - bigger cities have bigger bubbles.</p>
            <p>Hover over any bubble to see details about that location.</p>
            
            <h3>Collection Statistics</h3>
            <div id="stats">Loading statistics...</div>
        </div>
        
        <div class="info-card">
            <h2>Continents Legend</h2>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: blue;"></div>
                    <span>Europe</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: red;"></div>
                    <span>North America</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: green;"></div>
                    <span>Asia</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: purple;"></div>
                    <span>Oceania</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: orange;"></div>
                    <span>Africa</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: brown;"></div>
                    <span>South America</span>
                </div>
            </div>
            
            <h3>Size Representation</h3>
            <p>The bubble sizes on the map represent the population of each city:</p>
            <ul>
                <li>Larger bubbles = cities with higher populations</li>
                <li>Smaller bubbles = cities with lower populations</li>
            </ul>
            <p>The sizes are scaled logarithmically to ensure all points are visible while still showing relative differences.</p>
        </div>
    </div>

    <footer>
        <p>Created with ❤️ | Last updated: March 2025</p>
    </footer>

    <script>
        // Load and parse CSV data
        async function loadData() {
            try {
                const response = await fetch('snowglobe-collection.csv');
                const csvData = await response.text();
                
                return new Promise((resolve) => {
                    Papa.parse(csvData, {
                        header: true,
                        dynamicTyping: true,
                        complete: (results) => {
                            resolve(results.data);
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('map').innerHTML = 'Error loading data. Please ensure the CSV file is in the same directory as this HTML file.';
                return [];
            }
        }

        // Create the map visualization
        async function createMap() {
            const data = await loadData();
            if (!data.length) return;
            
            // Calculate bubble sizes using log scale
            const bubbleSizes = data.map(row => Math.log10(row.population) * 2);
            
            // Define continent colors
            const continentColors = {
                'Europe': 'blue',
                'North America': 'red',
                'Asia': 'green',
                'Oceania': 'purple',
                'Africa': 'orange',
                'South America': 'brown',
                'Antarctica': 'cyan'
            };
            
            // Create the scatter geo plot
            const trace = {
                type: 'scattergeo',
                lon: data.map(row => row.longitude),
                lat: data.map(row => row.latitude),
                text: data.map(row => 
                    `<b>${row.city}, ${row.country}</b><br>` +
                    `Population: ${row.population.toLocaleString()}<br>` +
                    `Continent: ${row.continent}<br>` +
                    `Country Code: ${row.country_code}<br>` +
                    `Coordinates: ${row.latitude.toFixed(4)}°, ${row.longitude.toFixed(4)}°<br>` +
                    `Collection #: ${row.index}`
                ),
                mode: 'markers',
                marker: {
                    size: bubbleSizes,
                    color: data.map(row => continentColors[row.continent] || 'gray'),
                    opacity: 0.7,
                    line: {
                        width: 1,
                        color: 'black'
                    },
                    sizemode: 'diameter',
                    sizeref: 0.5
                },
                hovertemplate: '<b>%{text}</b>'
            };
            
            // Generate continent legend traces
            const legendTraces = [];
            const seenContinents = new Set();
            
            data.forEach(row => {
                if (!seenContinents.has(row.continent) && continentColors[row.continent]) {
                    seenContinents.add(row.continent);
                    legendTraces.push({
                        type: 'scattergeo',
                        lon: [null],
                        lat: [null],
                        mode: 'markers',
                        marker: {
                            size: 10,
                            color: continentColors[row.continent]
                        },
                        name: row.continent,
                        showlegend: true
                    });
                }
            });
            
            // Combine all traces
            const traces = [trace, ...legendTraces];
            
            // Define layout
            const layout = {
                title: {
                    text: 'My Snowglobe Collection Around the World',
                    font: {
                        size: 24,
                        family: 'Arial',
                        color: 'darkblue'
                    },
                    y: 0.95
                },
                geo: {
                    projection: {
                        type: 'natural earth'
                    },
                    showland: true,
                    landcolor: 'rgb(243, 243, 243)',
                    countrycolor: 'rgb(204, 204, 204)',
                    showocean: true,
                    oceancolor: 'rgb(220, 240, 255)',
                    showlakes: true,
                    lakecolor: 'rgb(220, 240, 255)',
                    showrivers: true,
                    rivercolor: 'rgb(220, 240, 255)',
                    showcountries: true,
                    showcoastlines: true,
                    coastlinecolor: 'rgb(150, 150, 150)'
                },
                height: 650,
                margin: {
                    l: 0,
                    r: 0,
                    t: 50,
                    b: 0
                },
                hoverlabel: {
                    bgcolor: "white",
                    font: {
                        size: 12,
                        family: "Arial"
                    },
                    bordercolor: "darkgray"
                }
            };
            
            // Create the plot
            Plotly.newPlot('map', traces, layout, {responsive: true});
            
            // Update statistics
            updateStats(data);
        }
        
        // Update collection statistics
        function updateStats(data) {
            if (!data.length) return;
            
            // Get unique continents and countries
            const continents = new Set(data.map(row => row.continent));
            const countries = new Set(data.map(row => row.country));
            
            // Find largest and smallest cities by population
            let largestCity = data[0];
            let smallestCity = data[0];
            
            data.forEach(row => {
                if (row.population > largestCity.population) {
                    largestCity = row;
                }
                if (row.population < smallestCity.population) {
                    smallestCity = row;
                }
            });
            
            // Update the stats div
            const statsDiv = document.getElementById('stats');
            statsDiv.innerHTML = `
                <ul>
                    <li><strong>Total Snowglobes:</strong> ${data.length}</li>
                    <li><strong>Continents Represented:</strong> ${continents.size}</li>
                    <li><strong>Countries Represented:</strong> ${countries.size}</li>
                    <li><strong>Largest City:</strong> ${largestCity.city} (${largestCity.population.toLocaleString()} people)</li>
                    <li><strong>Smallest City:</strong> ${smallestCity.city} (${smallestCity.population.toLocaleString()} people)</li>
                </ul>
            `;
        }
        
        // Load the map when page is ready
        document.addEventListener('DOMContentLoaded', createMap);
    </script>
</body>
</html>
